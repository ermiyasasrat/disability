{%- liquid
  assign product_card_product = product_card_product | default: product
  assign media_size = media_size | default: 'square'
  assign portrait_aspect_ratio = portrait_aspect_ratio | default: '100'
  assign show_vendor = show_vendor | default: false
  assign show_rating = show_rating | default: false
  assign show_quick_add = show_quick_add | default: false
  assign lazy_load = lazy_load | default: true
  assign show_secondary_image = show_secondary_image | default: false
  assign placeholder_index = placeholder_index | default: 1
  assign image_width = image_width | default: 60
  assign image_height = image_height | default: 60
-%}

<div class="card-product sibling-product-card" data-product-id="{{ product_card_product.id }}">
  <div class="card-product__media">
    {%- if product_card_product.featured_media -%}
      <a href="{{ product_card_product.url }}" class="card-product__media-link">
        <img
          srcset="
            {%- if product_card_product.featured_media.width >= 165 -%}{{ product_card_product.featured_media | image_url: width: 165 }} 165w,{%- endif -%}
            {%- if product_card_product.featured_media.width >= 330 -%}{{ product_card_product.featured_media | image_url: width: 330 }} 330w,{%- endif -%}
            {{ product_card_product.featured_media | image_url }} {{ product_card_product.featured_media.width }}w
          "
          src="{{ product_card_product.featured_media | image_url: width: 330 }}"
          sizes="(min-width: 1200px) {{ image_width }}px, (min-width: 768px) {{ image_width }}px, {{ image_width | times: 0.85 | round }}px"
          alt="{{ product_card_product.featured_media.alt | escape }}"
          class="card-product__image"
          loading="lazy"
          width="{{ product_card_product.featured_media.width }}"
          height="{{ product_card_product.featured_media.height }}"
        >
      </a>
    {%- else -%}
      <a href="{{ product_card_product.url }}" class="card-product__media-link">
        {{ 'product-' | append: placeholder_index | placeholder_svg_tag: 'card-product__image placeholder-svg' }}
      </a>
    {%- endif -%}
  </div>

  <div class="card-product__content">
    <h3 class="card-product__title">
      <a href="{{ product_card_product.url }}" class="full-unstyled-link">
        {{ product_card_product.title | escape }}
      </a>
    </h3>

    {%- if show_vendor and product_card_product.vendor != blank -%}
      <div class="card-product__vendor">
        {{ product_card_product.vendor }}
      </div>
    {%- endif -%}

    <div class="card-product__price">
      {% render 'price', product: product_card_product, price_class: '' %}
    </div>

    {%- if show_rating and product_card_product.metafields.reviews.rating.value != blank -%}
      <div class="card-product__rating">
        {% render 'product-rating', product: product_card_product %}
      </div>
    {%- endif -%}

    {%- if show_quick_add -%}
      <div class="card-product__quick-add">
        {%- if product_card_product.available -%}
          {%- if product_card_product.variants.size == 1 -%}
            <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data" class="quick-add-form">
              <input type="hidden" name="id" value="{{ product_card_product.first_available_variant.id }}">
              <button type="submit" class="quick-add-button button button--small">
                {{ 'products.product.add_to_cart' | t }}
              </button>
            </form>
          {%- else -%}
            <a href="{{ product_card_product.url }}" class="quick-add-button button button--small">
              {{ 'products.product.choose_options' | t }}
            </a>
          {%- endif -%}
        {%- else -%}
          <span class="quick-add-button button button--small button--disabled">
            {{ 'products.product.sold_out' | t }}
          </span>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>
</div>
